---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumbs from '../Breadcrumbs.astro';
import PageIntroTooltip from '../PageIntroTooltip.astro';
import SiteHeader from '../SiteHeader.astro';
import TripTabs from '../TripTabs.astro';
import { getTripBarStats, getTripInlineFacts, getTripMobileFacts } from '../../lib/trips/all-trips';
import type { TripSection, TripSummary } from '../../lib/trips/types';

interface Props {
  title: string;
  description: string;
  trip: TripSummary;
  activeSection: TripSection;
  pageEyebrow: string;
  pageTitle: string;
  pageIntro: string;
}

const { title, description, trip, activeSection, pageEyebrow, pageTitle, pageIntro } = Astro.props;

const tripLabel = `${trip.title} / ${trip.dateLabel}`;
const tripBarStats = getTripBarStats(trip);
const tripInlineFacts = getTripInlineFacts(trip);
const tripMobileFacts = getTripMobileFacts(trip);
---

<BaseLayout title={title} description={description}>
  <div class="trip-shell" data-trip-theme={trip.themeId}>
    <SiteHeader
      headerKind="trip"
      railLabel="Trip summary"
      statItems={tripBarStats}
      stickyMode="mobile"
      mobileTitle={trip.title}
      mobileBackHref="/"
      mobileBackLabel="Back to trips"
      mobileFactsLabel="Trip facts"
      mobileFactsItems={tripMobileFacts}
    >
      <Breadcrumbs slot="context" tripLabel={tripLabel} />
      <TripTabs slot="desktop-tabs" trip={trip} activeSection={activeSection} />
      <TripTabs slot="mobile-tabs" trip={trip} activeSection={activeSection} />
    </SiteHeader>

    <main class="trip-shell__main trip-page-shell__main" id="main-content">
      <div class="trip-shell__page-header">
        <p class="page-label">{pageEyebrow}</p>
        <div class="trip-shell__page-title-row">
          <h1 class="page-title">{pageTitle}</h1>
          <PageIntroTooltip text={pageIntro} />
        </div>
        <ul class="trip-shell__meta-line">
          {tripInlineFacts.map((fact) => <li>{fact}</li>)}
        </ul>
        <p class="page-intro trip-shell__page-intro-desktop">{pageIntro}</p>
      </div>

      <slot />
    </main>
  </div>
</BaseLayout>
