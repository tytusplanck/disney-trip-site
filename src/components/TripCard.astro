---
import ChipList from './ChipList.astro';
import StatusBadge from './StatusBadge.astro';
import { getTripLandingPath, getTripSectionPath } from '../lib/trips/archive';
import type { ArchiveTripInsight } from '../lib/trips/details';
import type { TripSummary } from '../lib/trips/types';

interface Props {
  trip: TripSummary;
  insights?: ArchiveTripInsight[] | undefined;
}

const { trip, insights = [] } = Astro.props;

const cardHref = getTripLandingPath(trip);

const cardStats = [
  { label: 'People', value: trip.partySize === null ? '--' : String(trip.partySize) },
  { label: 'Days', value: trip.dayCount === null ? '--' : String(trip.dayCount) },
  { label: 'Rides', value: trip.attractionCount === null ? '--' : String(trip.attractionCount) },
  { label: 'Parks', value: trip.parkLabels.length === 0 ? '--' : String(trip.parkLabels.length) },
];

const chipItems = trip.parkLabels.length > 0 ? trip.parkLabels : ['Parks TBD'];
const planningLinks = [
  { label: 'Attractions', href: getTripSectionPath(trip, 'attractions') },
  { label: 'Schedule', href: getTripSectionPath(trip, 'schedule') },
  { label: 'Party', href: getTripSectionPath(trip, 'party') },
];
---

<article class="trip-card" data-trip-theme={trip.themeId} data-trip-status={trip.status}>
  <div class="trip-card__stripe" aria-hidden="true"></div>
  <div class="trip-card__body">
    <div class="trip-card__heading">
      <StatusBadge status={trip.status} />
      <h3 class="trip-card__title">{trip.title}</h3>
      <p class="trip-card__date">{trip.dateLabel}</p>
    </div>

    <ChipList items={chipItems} />
    <div class="trip-card__stats">
      {
        cardStats.map((stat) => (
          <div class="trip-card__stat">
            <strong class="trip-card__stat-value">{stat.value}</strong>
            <span class="trip-card__stat-label">{stat.label}</span>
          </div>
        ))
      }
    </div>

    {
      insights.length > 0 && (
        <dl class="trip-card__insights">
          {insights.map((insight) => (
            <div class="trip-card__insight">
              <dt class="trip-card__insight-label">{insight.label}</dt>
              <dd class="trip-card__insight-value">{insight.value}</dd>
              <p class="trip-card__insight-detail">{insight.detail}</p>
            </div>
          ))}
        </dl>
      )
    }
  </div>

  {
    trip.status === 'planning' ? (
      <>
        {trip.topPick && (
          <div class="trip-card__pick">
            <span class="trip-card__pick-star" aria-hidden="true">
              â€¢
            </span>
            <span class="trip-card__pick-label">Top pick:</span>
            <strong class="trip-card__pick-value">{trip.topPick}</strong>
          </div>
        )}
        <div class="trip-card__actions">
          <a class="trip-card__button" href={cardHref}>
            Open overview
          </a>

          <div class="trip-card__links-group trip-card__links-group--desktop">
            <p class="trip-card__links-label">Jump to</p>
            <div class="trip-card__links">
              {planningLinks.map((link) => (
                <a class="trip-card__link" href={link.href}>
                  {link.label}
                </a>
              ))}
            </div>
          </div>

          <details class="trip-card__links-panel">
            <summary class="trip-card__links-summary">Quick sections</summary>
            <div class="trip-card__links trip-card__links--stacked">
              {planningLinks.map((link) => (
                <a class="trip-card__link" href={link.href}>
                  {link.label}
                </a>
              ))}
            </div>
          </details>
        </div>
      </>
    ) : (
      <div class="trip-card__actions trip-card__actions--single">
        <a class="trip-card__button" href={cardHref}>
          Open overview
        </a>
        <p class="trip-card__future-note">
          Planning begins soon. The overview will fill in here first.
        </p>
      </div>
    )
  }
</article>
