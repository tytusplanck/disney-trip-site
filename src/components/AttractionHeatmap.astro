---
import { getPreferenceLegend, getPreferenceMeta } from '../lib/trips/details';
import type { AttractionHeatmapRow } from '../lib/trips/details';
import type { TripPartyMember } from '../lib/trips/types';

interface Props {
  party: TripPartyMember[];
  rows: AttractionHeatmapRow[];
}

const { party, rows } = Astro.props;
const legend = getPreferenceLegend();
---

<div class="trip-heatmap">
  <div class="trip-heatmap__scroll">
    <table class="trip-heatmap__table">
      <thead>
        <tr>
          <th class="trip-heatmap__heading trip-heatmap__heading--attraction">Attraction</th>
          {party.map((member) => <th class="trip-heatmap__heading">{member.name}</th>)}
          <th class="trip-heatmap__heading trip-heatmap__heading--score">Score</th>
        </tr>
      </thead>

      <tbody>
        {
          rows.map((row) => (
            <tr>
              <th class="trip-heatmap__attraction" scope="row">
                <span class="trip-heatmap__attraction-title">{row.attractionLabel}</span>
                <span class="trip-heatmap__attraction-meta">
                  {row.parkLabel} / {row.areaLabel}
                </span>
              </th>

              {row.ratings.map((rating) => {
                const meta = getPreferenceMeta(rating.tier);

                return (
                  <td class="trip-heatmap__cell">
                    <span
                      class:list={['trip-tier-token', `trip-tier-token--${rating.tier}`]}
                      title={`${rating.memberName}: ${meta.label}`}
                      aria-label={`${rating.memberName}: ${meta.label}`}
                    >
                      {meta.shortLabel}
                    </span>
                  </td>
                );
              })}

              <td class="trip-heatmap__score">{row.consensusScore}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>

  <div class="trip-heatmap__legend">
    <span class="trip-heatmap__legend-label">Legend</span>
    <ul class="trip-heatmap__legend-list">
      {
        legend.map((item) => (
          <li class="trip-heatmap__legend-item">
            <span class:list={['trip-tier-token', `trip-tier-token--${item.tier}`]}>
              {item.shortLabel}
            </span>
            <span>{item.label}</span>
          </li>
        ))
      }
    </ul>
  </div>
</div>
