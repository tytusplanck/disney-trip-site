---
import EmptyState from '../components/EmptyState.astro';
import SectionHeader from '../components/SectionHeader.astro';
import TripCard from '../components/TripCard.astro';
import ArchiveShell from '../components/shells/ArchiveShell.astro';
import { tripArchiveData } from '../data/trip-archive';
import { getArchiveSections, getArchiveStats } from '../lib/trips/archive';
import { archivePage } from './index.page';

const { footerNote, headerMetaLabel, meta, sections, stats } = archivePage;
const archiveSections = getArchiveSections(tripArchiveData.trips);
const archiveStats = getArchiveStats(tripArchiveData.trips);

const statItems = [
  { label: stats.tripsLabel, value: archiveStats.totalTrips },
  { label: stats.planningTripsLabel, value: archiveStats.planningTrips },
  { label: stats.ridesLabel, value: archiveStats.ridesScouted },
  { label: stats.peopleLabel, value: archiveStats.nextTripPeople },
  { label: stats.parksLabel, value: archiveStats.nextTripParks },
];

const sectionLabelByStatus = {
  planning: sections.planningLabel,
  upcoming: sections.upcomingLabel,
  completed: sections.completedLabel,
} as const;
---

<ArchiveShell
  title={meta.title}
  description={meta.description}
  metaLabel={headerMetaLabel}
  statItems={statItems}
  footerNote={footerNote}
>
  {
    archiveSections.map((section) => (
      <section class="archive-section">
        <SectionHeader
          label={sectionLabelByStatus[section.status]}
          countLabel={section.countLabel}
        />

        {section.trips.length > 0 ? (
          <div class="trip-grid">
            {section.trips.map((trip) => (
              <TripCard trip={trip} />
            ))}
          </div>
        ) : (
          section.status === 'completed' && <EmptyState text={sections.completedEmptyState} />
        )}
      </section>
    ))
  }
</ArchiveShell>
