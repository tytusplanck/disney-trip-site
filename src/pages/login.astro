---
import AuthShell from '../components/shells/AuthShell.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import { sanitizeRedirectTarget } from '../lib/auth/paths';
import { loginPage } from './login.page';

const error = Astro.url.searchParams.get('error');
const next = sanitizeRedirectTarget(Astro.url.searchParams.get('next'));
const hasError = error === 'invalid-password';
const { form, intro, meta } = loginPage;
---

<BaseLayout title={meta.title} description={meta.description}>
  <AuthShell metaLabel={intro.eyebrow}>
    <div class="auth-page">
      <section class="auth-card" aria-labelledby="login-title">
        <p class="page-label">{intro.eyebrow}</p>
        <h1 class="page-title" id="login-title">{intro.title}</h1>
        <p class="auth-card__quip">{intro.quip}</p>

        <form class="form-stack auth-card__form" action="/api/auth/login" method="post">
          <input type="hidden" name="next" value={next} />
          <label class="field" for="password">
            <span class="field__label">{form.passwordLabel}</span>
            <input
              class="auth-card__input"
              id="password"
              name="password"
              type="password"
              autocomplete="current-password"
              placeholder={form.passwordPlaceholder}
              required
            />
          </label>
          {
            hasError && (
              <p class="form-error" role="alert">
                {form.errorMessage}
              </p>
            )
          }
          <button class="button auth-card__button" type="submit">{form.submitLabel}</button>
        </form>
      </section>
    </div>
  </AuthShell>
</BaseLayout>
